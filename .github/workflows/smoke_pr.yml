name: PR Smoke (online)

on:
  pull_request:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install jq
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq

      - name: Run PR smoke
        env:
          # 线上 API；如需测本地自行覆盖 BASE
          BASE: "https://api.useportpulse.com"
          UNLOCODE: "USLAX"
          # 任选其一：PORTPULSE_API_KEY / PP_DEMO_KEY / KEY
          PORTPULSE_API_KEY: ${{ secrets.PORTPULSE_API_KEY }}
          # PP_DEMO_KEY: ${{ secrets.PP_DEMO_KEY }}   # <- 有需要可解注
          # KEY: ${{ secrets.PORTPULSE_API_KEY }}     # <- 也可直接用 KEY
        run: bash scripts/smoke_pr.sh